## D11 · 国际化与可访问性 (i18n & a11y)

### 1. 目标

确保产品能够服务于全球不同语言的用户，并为有特殊需求的群体（如视障、运动障碍用户）提供无障碍的访问体验。本规范涵盖**国际化 (i18n) 资源管理、从右到左 (RTL) 布局、键盘导航和 ARIA (Accessible Rich Internet Applications) 标签**的应用。

### 2. 国际化 (i18n)

#### 2.1 资源文件结构

*   **组织**: 所有翻译文本都应存储在 JSON 文件中，按语言代码组织。
    ```
    /apps/web/src/locales/
      ├── en.json
      ├── zh.json
      └── ar.json
    ```
*   **键名**: 使用点分隔的命名空间作为键名，以保证结构清晰、易于管理。
    ```json
    // en.json
    {
      "game": {
        "phase": {
          "night": "Night falls. Close your eyes.",
          "dayTalk": "Daytime. Discuss and find the werewolves."
        }
      },
      "roles": {
        "werewolf": "Werewolf",
        "seer": "Seer"
      },
      "notifications": {
        "voted_successfully": "Your vote for player {seat} has been cast.",
        "players_in_room": "{count, plural, =0 {No players yet} =1 {1 player} other {# players}} in the room."
      }
    }
    ```

#### 2.2 技术实现

*   **框架**: 使用成熟的 i18n 框架，如 `i18next` 或 `vue-i18n`。
*   **语言检测**: 默认根据用户浏览器的 `Accept-Language` 头来选择语言，并允许用户在设置中手动切换。
*   **占位符与复数**:
    *   **占位符**: 使用 ICU MessageFormat 标准处理动态数据，如 `{seat}`。
    *   **复数**: 同样使用 ICU 标准处理单复数问题，如 `{count, plural, ...}`。
*   **日期与数字**: 使用浏览器原生的 `Intl` API (`Intl.DateTimeFormat`, `Intl.NumberFormat`) 来格式化日期和数字，以符合用户所在地区的习惯。

#### 2.3 从右到左 (RTL) 布局

*   **适配**: 对于阿拉伯语 (ar)、希伯来语 (he) 等 RTL 语言，必须在 HTML 根元素上设置 `dir="rtl"`。
*   **CSS**:
    *   使用**逻辑属性**而非物理属性。例如，用 `margin-inline-start` 代替 `margin-left`，用 `padding-inline-end` 代替 `padding-right`。
    *   对于具有方向性的图标（如箭头），需要在 RTL 模式下进行水平翻转 (`transform: scaleX(-1)`)。
*   **布局**: 聊天气泡等左右对齐的元素，在 RTL 模式下需要镜像对齐。

### 3. 可访问性 (a11y)

#### 3.1 键盘导航

*   **核心原则**: 用户必须能够**仅使用键盘**完成所有核心游戏流程（登录、建房、入房、发言、投票、查看结果）。
*   **焦点管理**:
    *   所有可交互的元素（按钮、输入框、链接）都必须是可聚焦的。
    *   当前获得焦点的元素必须有清晰的视觉提示（如高亮轮廓 `outline`）。
    *   模态框（Dialog）打开时，焦点应被“锁定”在模态框内部；关闭后，焦点应返回到触发它的元素上。
*   **快捷键**: 为常用操作提供快捷键，如 `Enter` 发言，`Esc` 关闭弹窗。

#### 3.2 屏幕阅读器与 ARIA

*   **语义化 HTML**: 尽可能使用语义化的 HTML 标签（如 `<nav>`, `<main>`, `<button>`），这是 a11y 的基础。
*   **ARIA 角色**: 为非语义化的自定义组件添加 `role` 属性，以告知屏幕阅读器其用途。
    *   `role="timer"`: 倒计时器。
    *   `role="status"`: 游戏阶段状态栏。
    *   `role="log"`: 聊天/事件日志区域。
*   **ARIA 标签**:
    *   `aria-label`: 为没有可见文本的图标按钮提供说明。
    *   `aria-live="polite"`: 用于需要向用户播报的动态更新区域（如“玩家 3 已发言”），`polite` 表示在用户空闲时播报。
    *   `aria-hidden="true"`: 对纯装饰性的、对理解无益的元素进行隐藏。

#### 3.3 视觉可访问性

*   **颜色对比度**: 所有文本与背景的对比度必须满足 **WCAG 2.1 AA** 级标准 (≥ 4.5:1)。
*   **高对比度主题**: 提供一个可选的高对比度主题。
*   **字体缩放**: 网站应能响应浏览器的字体缩放设置，确保文本在放大后不会溢出或重叠。
*   **色盲友好**: 避免仅使用颜色来传达重要信息。例如，除了用红/绿色表示玩家状态外，还应辅以图标或文本标签。

### 4. 测试与验收

*   **i18n 快照测试**: 在 CI/CD 流程中，对关键 UI 界面在多种语言（如 `en`, `zh`, `ar`）下进行视觉回归快照测试，确保布局不被破坏、文本不被截断。
*   **a11y 自动化检查**: 集成 `axe-core` 或 `Lighthouse` 到端到端测试流程中，自动扫描并报告可访问性问题。
*   **手动测试清单**:
    1.  拔掉鼠标，只用键盘能否完成一局完整的游戏？
    2.  使用屏幕阅读器（如 NVDA, VoiceOver）浏览网站，体验是否流畅、信息是否完整？
    3.  将浏览器语言切换为一种 RTL 语言，检查布局是否正确镜像？
*   **验收标准**:
    *   全站无明显未翻译的“硬编码”文案。
    *   Lighthouse a11y 评分 ≥ 90。
    *   无 WCAG 2.1 A 或 AA 级的严重阻塞性问题。