# NATS Production Configuration
# Optimized for production environment

# Server information
server_name: werewolves_prod
host: "0.0.0.0"
port: 4222

# Monitoring
monitor_port: 8222
http_port: 8222

# Logging
log_file: "/var/log/nats/nats-server.log"
logtime: true
debug: false
trace: false

# Authorization
authorization {
    users: [
        { user: "werewolves_api", password: "${NATS_API_PASSWORD}" }
        { user: "werewolves_agents", password: "${NATS_AGENTS_PASSWORD}" }
        { user: "werewolves_ws", password: "${NATS_WS_PASSWORD}" }
    ]
}

# JetStream configuration
jetstream {
    store_dir: "/data/jetstream"
    max_memory_store: 1GB
    max_file_store: 10GB
    sync_interval: "2m"
    max_age: "30d"
}

# Clustering configuration
cluster {
    name: "werewolves_cluster_prod"
    host: "0.0.0.0"
    port: 6222
    routes: [
        "nats://node1:6222"
        "nats://node2:6222"
        "nats://node3:6222"
    ]
    gateways: [
        { name: "prod", url: "nats://gateway:7222" }
    ]
}

# WebSocket support
websocket {
    port: 8080
    allow_non_tls: false
    tls {
        cert_file: "/etc/nats/cert.pem"
        key_file: "/etc/nats/key.pem"
    }
}

# Limits
max_connections: 10000
max_control_line: 512
max_payload: 1MB
max_pending: 64MB
write_deadline: "2s"

# TLS configuration
tls {
    cert_file: "/etc/nats/cert.pem"
    key_file: "/etc/nats/key.pem"
    ca_file: "/etc/nats/ca.pem"
    verify: true
    verify_and_map: true
}

# Health checks
lame_duck_duration: "2m"
lame_duck_grace_period: "30s"